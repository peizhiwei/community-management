<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
 PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
 "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.peizhiwei.community.dao.PayInfoDetailsDao">
	<!-- 获取所有缴费信息 -->
	<select id="getallpayinfo" resultType="com.peizhiwei.community.entity.PayInfoDetails">
		SELECT i.*,h.owner_name as `houseOwner.ownerName`,hi.house_number as `houseOwner.houseInfo.houseNumber`,
			   t.pay_type_name as `payType.payTypeName`,m.method_name as `payMethod.methodName`
		FROM pay_info_details i
		LEFT JOIN house_owner h ON h.owner_id=i.owner_id
		LEFT JOIN house_info hi ON h.house_id=hi.house_id
		LEFT JOIN pay_type t ON t.pay_type_id=i.pay_type_id
		LEFT JOIN pay_method m ON m.method_id=i.method_id
	</select>
	<!-- 已缴费，修改缴费状态为已缴费，由管理员操作的缴费方式默认为现金 -->
	<update id="updatepaystate" parameterType="com.peizhiwei.community.entity.PayInfoDetails">
		UPDATE `pay_info_details` 
		SET `pay_time` = #{payTime}, `pay_state` = 1,`method_id` = #{payMethod.methodId}
		WHERE `pay_id` = #{payId}
	</update>
	<!-- 根据缴费方式名称查找对应的id -->
	<select id="getpaymethodid" parameterType="String" resultType="int">
		SELECT method_id FROM pay_method
		WHERE method_name=#{methodName}
	</select>
</mapper>